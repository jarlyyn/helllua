quest={}
quest["end"]={}
quest.stop=true
quest.resume=nil
quest["main"]={}
quest.name=""
loadmod("caxie.mod")
quest.main["caxie"]=function()
	do_caxie(caxie.main,caxie.main)
	quest.resume=quest.main["caxie"]
end
quest["end"]["caxie"]=function()
	caxie["end"]()
end
loadmod("beiqi.mod")
quest.main["beiqi"]=function()
	beiqi["main"]()
	quest.resume=quest.main["beiqi"]
end
quest["end"]["beiqi"]=function()
	beiqi["end"]()
end
loadmod("letter.mod")
quest.main["letter"]=function()
	do_letter(letter.loop,letter.loop)
	quest.resume=quest.main["letter"]
end
quest["end"]["caxie"]=function()
	caxie["end"]()
end
loadmod("fish.mod")
quest.main["fish"]=function()
	do_fish(fish.loop,fish.loop)
	quest.resume=quest.main["fish"]
end
quest["end"]["fish"]=function()
	fish["end"]()
end
loadmod("liandan.mod")
quest.main["liandan"]=function()
	do_liandan(liandan.loop,liandan.loop)
	quest.resume=quest.main["liandan"]
end
quest["end"]["liandan"]=function()
	liandan["end"]()
end
loadmod("dutable.mod")
quest.main["dutable"]=function()
	do_dutable(dutable.loop,dutable.loop)
	quest.resume=quest.main["dutable"]
end
quest["end"]["dutable"]=function()
	dutable["end"]()
end
loadmod("masterquest.mod")
quest.main["mq"]=function()
	mqquests=0
	mqstarttime=os.time()
	do_masterquest(masterquest.loop,masterquest.loop)
	quest.resume=masterquest.resume
end
quest["end"]["mq"]=function()
	masterquest["end"]()
end
do_quest=function(name)
	quest.name=name
	initmud()
	if quest.main[name]~=nil then
		unhookall()
		quest.stop=false
		getinfo(quest_begin)
	end
end
quest_begin=function()
	quest["main"][quest.name]()
end
initmud=function()
	run(mudsettings)
end

resume=function()
	if quest.stop==false then
		walk["stop"]()
		unhookall()
		_roomid=-1
		inittri()
		getinfo(quest["resume"])
	end
end
